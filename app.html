<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Study Companion — Home</title>

  <!-- PWA / Icons -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="application-name" content="Study Companion">
  <meta name="theme-color" content="#0d6efd">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="icons/logo.png">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='100%25' height='100%25' rx='12' fill='%230d6efd'/%3E%3Ctext x='50%25' y='58%25' text-anchor='middle' font-family='Arial' font-size='38' fill='white'%3ESC%3C/text%3E%3C/svg%3E">

  <!-- CSP -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data: blob:;
                 font-src 'self' data: https://cdnjs.cloudflare.com;
                 style-src 'self' 'unsafe-inline' blob: https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;
                 style-src-elem 'self' 'unsafe-inline' blob: https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;
                 script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com;
                 connect-src 'self' blob:;
                 worker-src 'self' blob: https://cdnjs.cloudflare.com;
                 object-src 'none';
                 base-uri 'self';
                 upgrade-insecure-requests;">

  <!-- CSS libs -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet"/>

  <!-- Vendor core for your ecosystem -->
  <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/epubjs@0.3.92/dist/epub.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>if(window['pdfjsLib']){pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';}</script>
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- 3D look & layout -->
  <style>
    :root{
      --radius: 16px;
      --card-bg: var(--bs-body-bg);
      --shadow-3d: 0 12px 34px rgba(13,110,253,.22), 0 2px 10px rgba(0,0,0,.08);
      --shadow-soft: 0 10px 28px rgba(0,0,0,.08);
    }
    html,body{height:100%}
    body{
      margin:0; min-height:100vh; overflow-x:hidden;
      background:
        radial-gradient(1200px 700px at -10% -20%, rgba(13,110,253,.12), transparent 60%),
        radial-gradient(800px 600px at 110% 120%, rgba(32,201,151,.14), transparent 60%),
        linear-gradient(180deg, var(--bs-body-bg), var(--bs-body-bg));
    }

    /* Nav */
    .nav-3d{
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(255,255,255,.82), rgba(255,255,255,.62));
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    [data-bs-theme="dark"] .nav-3d{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border-color: rgba(255,255,255,.14);
    }

    /* Panels */
    .panel-3d{
      background: var(--card-bg); border-radius: var(--radius);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: var(--shadow-3d); padding:16px;
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .panel-3d:hover{ transform: translateY(-2px); }
    [data-bs-theme="dark"] .panel-3d{ border-color: rgba(255,255,255,.12); }
    .section-title{ font-weight:800; letter-spacing:.2px; }

    /* Fancy buttons */
    .btn-3d{ box-shadow: 0 8px 22px rgba(13,110,253,.25); border:1px solid rgba(13,110,253,.38); }
    .btn-3d:active{ transform: translateY(1px); box-shadow: 0 3px 10px rgba(13,110,253,.22); }

    /* Planner Kanban */
    .kanban{ display:grid; grid-template-columns: 1fr; gap:14px; }
    @media (min-width: 992px){ .kanban{ grid-template-columns: repeat(3, 1fr); } }
    .lane{ border-radius: 14px; border:1px solid rgba(0,0,0,.06); box-shadow: var(--shadow-soft); background: var(--card-bg); padding:10px; }
    [data-bs-theme="dark"] .lane{ border-color: rgba(255,255,255,.12); }
    .lane-title{ font-weight:700; margin-bottom:6px; }
    .task-card{
      border-radius: 12px; border: 1px solid rgba(0,0,0,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.90));
      padding: 10px 12px; box-shadow: 0 8px 20px rgba(0,0,0,.06);
      transition: transform .18s ease, box-shadow .18s ease; margin-bottom:10px;
    }
    .task-card:hover{ transform: translateY(-2px); box-shadow: 0 12px 26px rgba(13,110,253,.22); }
    [data-bs-theme="dark"] .task-card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.06));
      border-color: rgba(255,255,255,.12);
    }
    .task-title.done{ text-decoration: line-through; opacity:.65 }

    /* Masonry */
    .masonry{ column-count: 1; column-gap: 14px; }
    @media (min-width: 576px){ .masonry{ column-count: 2; } }
    @media (min-width: 992px){ .masonry{ column-count: 3; } }
    .masonry .h-card{
      display:inline-block; width:100%;
      margin:0 0 14px; border-radius: 14px; overflow: hidden;
      border: 1px solid rgba(0,0,0,.06); background: var(--card-bg); box-shadow: var(--shadow-soft);
    }
    [data-bs-theme="dark"] .masonry .h-card{ border-color: rgba(255,255,255,.12); }
    .h-card .h-body{ padding: 12px; }
    .h-quote{ font-style: italic; }
    .h-doc{ font-size: 12px; color: var(--bs-secondary-color); }

    /* Tag cloud */
    .tag-cloud{ display:flex; flex-wrap:wrap; gap:8px; }
    .tag-chip{ border:1px solid rgba(0,0,0,.08); border-radius:999px; padding:.25rem .6rem; font-size:.85rem; }
    [data-bs-theme="dark"] .tag-chip{ border-color: rgba(255,255,255,.14); }

    /* Fade-in */
    .fade-in{ opacity:0; transform: translateY(6px); transition: opacity .45s ease, transform .45s ease; }
    .fade-in.show{ opacity:1; transform: translateY(0); }
  </style>
</head>
<body>

  <!-- Topbar -->
  <nav class="navbar nav-3d sticky-top">
    <div class="container-fluid">
      <div class="d-flex align-items-center gap-2">
        <a class="btn btn-sm btn-outline-secondary" href="settings.html" title="Settings"><i class="fa-solid fa-gear"></i></a>
        <button class="btn btn-sm btn-outline-secondary" id="theme-toggle" title="Theme"><i class="fa-solid fa-moon"></i></button>
      </div>
      <div class="fw-bold">Study Companion</div>
      <div class="d-flex align-items-center gap-2">
        <a class="btn btn-sm btn-outline-primary" href="library.html" title="Library"><i class="fa-solid fa-books"></i></a>
        <a class="btn btn-sm btn-outline-primary" href="meetings.html" title="Meetings"><i class="fa-solid fa-calendar"></i></a>
      </div>
    </div>
  </nav>

  <main class="container py-3">

    <!-- Quick Actions -->
    <section class="panel-3d fade-in mb-3">
      <div class="d-flex align-items-center justify-content-between">
        <div class="section-title"><i class="fa-solid fa-rocket me-2"></i>Quick Actions</div>
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-primary btn-sm btn-3d" id="qa-continue"><i class="fa-solid fa-forward me-1"></i>Continue</button>
          <button class="btn btn-outline-primary btn-sm" id="qa-import"><i class="fa-solid fa-upload me-1"></i>Import</button>
          <a class="btn btn-outline-primary btn-sm" href="meetings.html"><i class="fa-solid fa-pen-to-square me-1"></i>Editor</a>
          <a class="btn btn-outline-secondary btn-sm" href="notes.html"><i class="fa-regular fa-note-sticky me-1"></i>All Notes</a>
          <button class="btn btn-outline-secondary btn-sm" id="qa-library"><i class="fa-solid fa-books me-1"></i>Library</button>
        </div>
      </div>
    </section>

    <!-- Study Planner (Kanban) -->
    <section class="panel-3d fade-in mb-3">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <div class="section-title"><i class="fa-regular fa-calendar-check me-2"></i>Study Planner</div>
        <div class="d-flex gap-2">
          <button class="btn btn-primary btn-sm btn-3d" data-bs-toggle="modal" data-bs-target="#plannerModal"><i class="fa-solid fa-plus me-1"></i>Add</button>
          <button class="btn btn-outline-secondary btn-sm" id="planner-filter-today">Today</button>
          <button class="btn btn-outline-secondary btn-sm" id="planner-filter-week">This Week</button>
          <button class="btn btn-outline-secondary btn-sm" id="planner-filter-all">All</button>
        </div>
      </div>
      <div id="planner-kanban" class="kanban">
        <div class="lane" data-lane="today">
          <div class="lane-title">Today</div>
          <div class="lane-body" id="kanban-today"></div>
        </div>
        <div class="lane" data-lane="week">
          <div class="lane-title">This Week</div>
          <div class="lane-body" id="kanban-week"></div>
        </div>
        <div class="lane" data-lane="later">
          <div class="lane-title">Later</div>
          <div class="lane-body" id="kanban-later"></div>
        </div>
      </div>
    </section>

    <!-- Upcoming Timeline + Focus Timer + Stats -->
    <div class="row g-3">
      <div class="col-12 col-xl-6">
        <section class="panel-3d fade-in h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="section-title"><i class="fa-regular fa-bell me-2"></i>Upcoming</div>
            <button class="btn btn-sm btn-outline-primary" id="btn-enable-notifs"><i class="fa-regular fa-circle-check me-1"></i>Enable alerts</button>
          </div>
          <div id="upcoming-list" class="small text-muted">Loading…</div>
        </section>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <section class="panel-3d fade-in h-100">
          <div class="section-title mb-2"><i class="fa-regular fa-hourglass-half me-2"></i>Focus Timer</div>
          <div id="ftimer">
            <div class="display-5 text-center" id="ft-time">25:00</div>
            <div class="d-flex justify-content-center gap-2 my-2">
              <button class="btn btn-primary btn-sm" id="ft-start"><i class="fa-solid fa-play"></i></button>
              <button class="btn btn-outline-secondary btn-sm" id="ft-pause"><i class="fa-solid fa-pause"></i></button>
              <button class="btn btn-outline-danger btn-sm" id="ft-reset"><i class="fa-solid fa-rotate-left"></i></button>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-outline-secondary btn-sm w-100" data-ft="pomodoro">Pomodoro</button>
              <button class="btn btn-outline-secondary btn-sm w-100" data-ft="short">Short</button>
              <button class="btn btn-outline-secondary btn-sm w-100" data-ft="long">Long</button>
            </div>
          </div>
        </section>
      </div>
      <div class="col-12 col-md-6 col-xl-3">
        <section class="panel-3d fade-in h-100">
          <div class="section-title mb-2"><i class="fa-solid fa-chart-line me-2"></i>Stats & Streak</div>
          <div id="stats-box" class="small">Loading…</div>
        </section>
      </div>
    </div>

    <!-- Smart Folders + Tag Cloud -->
    <div class="row g-3 mt-1">
      <div class="col-12 col-lg-6">
        <section class="panel-3d fade-in h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="section-title"><i class="fa-regular fa-folder-open me-2"></i>Smart Folders</div>
            <a class="small" href="notes.html">Open Notes</a>
          </div>
          <div id="smart-folders" class="small text-muted">Loading…</div>
        </section>
      </div>
      <div class="col-12 col-lg-6">
        <section class="panel-3d fade-in h-100">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="section-title"><i class="fa-solid fa-tags me-2"></i>Tags</div>
            <div class="small text-muted">From recent highlights</div>
          </div>
          <div id="tag-cloud" class="tag-cloud small text-muted">Loading…</div>
        </section>
      </div>
    </div>

    <!-- Masonry Highlights -->
    <section class="panel-3d fade-in my-3">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <div class="section-title"><i class="fa-regular fa-highlighter me-2"></i>Masonry Highlights</div>
        <div class="small text-muted">Your recent quotes & notes</div>
      </div>
      <div id="masonry" class="masonry"></div>
    </section>

    <!-- Quick Capture -->
    <section class="panel-3d fade-in mb-3">
      <div class="d-flex align-items-center justify-content-between">
        <div class="section-title"><i class="fa-regular fa-note-sticky me-2"></i>Quick Capture</div>
        <div>
          <button class="btn btn-sm btn-outline-secondary" id="qc-clear">Clear</button>
          <button class="btn btn-sm btn-primary" id="qc-save"><i class="fa-solid fa-save me-1"></i>Save</button>
        </div>
      </div>
      <textarea id="qc-text" class="form-control mt-2" rows="3" placeholder="Write a quick thought…"></textarea>
    </section>

  </main>

  <!-- Add Planner Modal -->
  <div class="modal fade" id="plannerModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Add Planner Item</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <div class="row g-2">
            <div class="col-12">
              <label class="form-label">Title</label>
              <input id="pl-title" class="form-control" placeholder="e.g., Study Chapter 3">
            </div>
            <div class="col-6">
              <label class="form-label">Date</label>
              <input id="pl-date" type="date" class="form-control">
            </div>
            <div class="col-6">
              <label class="form-label">Time</label>
              <input id="pl-time" type="time" class="form-control">
            </div>
            <div class="col-12">
              <label class="form-label">Type</label>
              <select id="pl-type" class="form-select">
                <option value="study">Study</option>
                <option value="meeting">Meeting</option>
                <option value="review">Review</option>
                <option value="task">Task</option>
              </select>
            </div>
            <div class="col-12">
              <div class="form-check">
                <input id="pl-remind" class="form-check-input" type="checkbox" checked>
                <label class="form-check-label" for="pl-remind">Remind me (day-before & at time)</label>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="pl-save" class="btn btn-primary"><i class="fa-solid fa-floppy-disk me-1"></i>Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index:1080">
    <div id="app-toast" class="toast align-items-center text-bg-primary border-0 shadow" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="app-toast-body">Saved.</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <!-- JS libs -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Your core app (kept for ecosystem functions like import, library, etc.) -->
  <script type="module" src="js/app.js"></script>

  <!-- New modules -->
  <script type="module" src="js/planner.js"></script>
  <script type="module" src="js/focusTimer.js"></script>
  <script type="module" src="js/dashboard.js"></script>
</body>
</html>
